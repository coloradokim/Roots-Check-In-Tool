webpackJsonp([3],[function(t,e,n){function i(t){r.findWhere(l,{id:t})||(l=l.concat({id:t,text:t}),a('select[name="focus_area"]').select2({data:l,tags:!0,allowClear:!0,width:"style"}))}function s(t,e){a("#add-event-text").text("   Add Event"),a('#activity-form select[name="activity"]').val(null),a('#activity-form select[name="focus_area"]').select2("val",null),e||a("#add-event").off("click"),t&&(a("#activity-form").hide("fast"),a("#calendar-button-container").show("fast"))}var r=n(3),a=(n(1),n(2));n(93),n(5),n(6);var o=[],l=r.chain(FOCUS_AREAS).keys().sortBy().value().map(function(t){return{id:t,text:t}}),u=function(t){this.googleId=t.googleId,this.name=t.name,this.image=t.image,this.calendar=t.groveCalendar||[],this.option=a("<option>"+t.name+"</option>").attr("value",t.googleId),this.optionRendered=!1,this.eventDisplays=r.map(t.groveCalendar,function(t,e){return new c(this,t,e)}.bind(this))||[]};u.prototype.renderOption=function(t){this.optionRendered||(a(t).append(this.option),this.optionRendered=!0)},u.prototype.renderEvents=function(t){r.each(this.eventDisplays,function(e){e.render(t),i(e.event.focus_area)})},u.prototype.updateSort=function(t,e){var n=this,i=a("#events-list").sortable("toArray",{attribute:"data-index"});i.forEach(function(t,e){t!=e&&(n.eventDisplays[t].index=e,a(n.eventDisplays[t].el).attr("data-index",e))}),this.eventDisplays=r.sortBy(this.eventDisplays,"index"),a("#save-calendar").removeClass("disabled").empty().append('<i class="fa fa-calendar"></i>   Save Grove Cycle')},u.prototype.renderCalendar=function(t){a("#student-name").text(this.name),a("#title-text").text("'s Grove Cycle"),a("#student-icon").empty().append('<img class="student-icon" src="'+this.image+'">'),s(!0,!1),a(t).empty(),this.renderEvents(t);var e=this;a("#calendar-container").show(),a("#events-list").sortable({stop:e.updateSort.bind(e)}),a("#create-new-event").off("click").on("click",function(t){a("#activity-legend").text("New event for: "+e.name),a("#activity-form").show("fast"),a("#add-event").on("click",function(t){t.preventDefault();var n={},r=a('#activity-form select[name="activity"]').val();n.location=r.split("#")[0],n.activity=r.split("#")[1];var o=e.eventDisplays.length,l=a('#activity-form select[name="focus_area"]').val();n.focus_area=l,i(l),n=new c(e,n,o),e.eventDisplays.push(n),n.render("#events-list"),s(!1,!0),a("#save-calendar").removeClass("disabled").empty().append('<i class="fa fa-calendar"></i>   Save Grove Cycle')}),a("#cancel-event-add").on("click",function(t){t.preventDefault(),s(!0)})}),a("#save-calendar").empty().append('<i class="fa fa-calendar"></i>   Save Grove Cycle').addClass("disabled"),a("#save-calendar").off("click").on("click",function(t){a("#save-calendar").empty().text("Saving...").addClass("disabled");var n=e.eventDisplays.map(function(t){return t.event.checkedIn=!1,t.event});a.ajax("/api/grove/"+e.googleId,{method:"PUT",data:JSON.stringify({calendar:n}),contentType:"application/json",success:function(){a("#save-calendar").empty().append('<i class="fa fa-calendar"></i>   Cycle Saved!')},error:function(t,e,n){a("#save-calendar").empty().removeClass("btn-success").addClass("btn-danger").text("Error Saving").removeClass("disabled")}})})};var c=function(t,e,n){this.student=t,this.event=e,this.index=n,this.el=this.createDisplay()};c.prototype.createDisplay=function(){var t="<tr></tr>",e=a("<td></td>").text(this.event.location),n=a("<td></td>").text(this.event.activity),i=a("<td></td>").text(this.event.focus_area),s="<td></td>";this.editButton=a('<button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>'),s=a(s).append(this.editButton);var r="<td></td>";return this.removeButton=a('<button class="btn btn-xs btn-danger"><i class="fa fa-times"></i></button>'),r=a(r).append(this.removeButton),a(t).attr("data-index",this.index).append(e,n,i,s,r)[0]},c.prototype.render=function(t,e){var n=this;if(e){var r=n.el;n.el=n.createDisplay(),a(r).replaceWith(n.el)}else a(t).append(this.el);a(this.editButton).click(function(t){a('#activity-form select[name="activity"]').val(n.event.location+"#"+n.event.activity),a('#activity-form select[name="focus_area"]').select2("val",n.event.focus_area),a("#add-event-text").text("   Save"),a("#activity-form").show("fast",function(){a("#add-event").off("click").one("click",function(t){t.preventDefault();var e=a('#activity-form select[name="activity"]').val();e?(n.event.location=e.split("#")[0],n.event.activity=e.split("#")[1]):(n.event.location="",n.event.activity="");var r=a('#activity-form select[name="focus_area"]').val();n.event.focus_area=r,i(r),s(!0),n.render("#events-list",!0),a("#save-calendar").removeClass("disabled")}),a("#cancel-event-add").on("click",function(t){t.preventDefault(),s(!0)})})}),a(this.removeButton).click(function(t){a(n.el).remove(),n.student.eventDisplays.splice(n.index,1),n.student.eventDisplays.forEach(function(t){t.index>n.index&&t.index--}),s(!0)})},a(function(){r.keys(GROVE_ACTIVITIES).forEach(function(t){var e=a("<optgroup>").attr("label",t);GROVE_ACTIVITIES[t].forEach(function(n){var i=a("<option>").attr("value",[t,n].join("#")).text(n);e.append(i)}),a('select[name="activity"]').append(e)}),a('select[name="focus_area"]').css("width","100%").select2({data:l,tags:!0,width:"style"}),a.get("/api/grove",function(t){o=r.map(r.sortBy(t,"name"),function(t){return student=new u(t),student.renderOption("#student-names-select"),student}),a("#student-names-select").on("change",function(t){var e=r.find(o,{googleId:t.target.value});e.renderCalendar("#events-list")}),a("#student-name-search").on("keyup",function(t){a("#student-names-select").css("visibility","");var e=a(this).val().toLowerCase();r.each(o,function(t){t.name.toLowerCase().match(e)?t.renderOption("#student-names-select"):(a(t.option).remove(),t.optionRendered=!1)}),1===a("#student-names-select option").length&&a("#student-names-select").trigger("change")})})})}]);