webpackJsonp([2],[function(t,e,i){function n(t,e){var i=u(t).attr("data-name"),n=u(e).attr("data-name");return u(e).hasClass("Found")-u(t).hasClass("Found")||(i>n)-1||1}function s(t){return t.split(" ").map(function(t){return t[0].toUpperCase()+t.slice(1)}).join(" ")}function r(t){var e=u("<div>").addClass("studentLocationDisplay").addClass("col-md-2").attr("id",t.googleId).attr("data-name",t.name),i=u("<div>").addClass("nameImageContainer"),n=u("<button>").addClass("btn btn-xs btn-primary absent-toggle").text(t.absent?"Present":"Absent"),s=u("<div>").append(n),r=u("<div>").addClass("studentInfoContainer"),a=u("<div>").addClass("name").text(t.name),o=u("<div>").append(u("<img>").addClass("studentImage").attr("src",t.image));return i.append(a).append(o),e.append(i).append(r).append(s),n.on("click",this.toggleAbsent.bind(this)),e}function a(t){var e=o.find(d,function(e){return e.data.googleId===t.googleId});e&&(e.transitionTimeout&&window.clearTimeout(e.transitionTimeout),e.recentScan=t,e.onScan.call(e,t))}var o=i(3),l=i(1),u=i(2),c=o.partial(i(4),EVENT_LENGTH,TRANSITION_LENGTH),d=[],h="All",p=function(t){if(this.data=o.pick(t,["_id","email","name","image","googleId","absent"]),this.el=r.call(this,t),t.absent)this.status="Absent",this.updateDisplay();else if(t.recentScan){scan=t.recentScan;var e=!1,i=scan.event[0];i&&i.end&&l(i.end).subtract(TRANSITION_LENGTH,"ms").isAfter(Date.now())?e=!0:i&&!i.end&&l(scan.time).add(EVENT_LENGTH-TRANSITION_LENGTH,"ms").isAfter(Date.now())&&(e=!0),e?(this.recentScan=scan,this.onScan(scan)):(this.status="Lost",this.updateDisplay())}else this.status="Lost",this.updateDisplay()};p.prototype.toggleAbsent=function(t){t.preventDefault(),this.status="Absent"===this.status?"Lost":"Absent";var e=this;u.post("/api/user/",{id:this.data.googleId,absent:!this.data.absent},e.updateDisplay.bind(e))},p.prototype.updateDisplay=function(){if("Absent"!=this.status&&this.el.find(".absent-toggle").text("Absent"),"Found"===this.status){var t=this.recentScan.event[0],e=o.chain(["summary","activity","focus_area"]).map(function(e){return t[e]}).filter().join(" | ").value(),i=u("<p>").addClass("last-scan-info").addClass("text-primary").text(e);this.el.find(".studentInfoContainer").empty().append(i),this.el.removeClass("Lost").addClass("Found"),this.render()}else if("Lost"===this.status){var n=this;u.get("/current-event/"+this.data.googleId,function(t){n.el.removeClass("Found").addClass("Lost");var e=n.el.find(".studentInfoContainer");e.empty(),u("<p>").addClass("correct-location-info text-primary").text(t.location).appendTo(e),n.recentScan&&u("<p>").addClass("last-scan-info text-danger").text(n.recentScan.scannedLocation).appendTo(n.el.find(".studentInfoContainer")),n.currentLocation=t.location,n.render()})}else"Absent"===this.status&&(this.el.removeClass("Found").addClass("Lost"),this.currentLocation="Absent",this.el.find(".absent-toggle").text("Present"),this.render())},p.prototype.render=function(){this.el&&this.el.remove();var t=u("#"+this.currentLocation.replace(/ /g,""));t.append(this.el);var e=t.find(".studentLocationDisplay").sort(n);e.detach().appendTo(t),this.el.find(".absent-toggle").off("click").on("click",this.toggleAbsent.bind(this))},p.prototype.onScan=function(t){var e=this;if(t&&t.correct){this.currentLocation=t.scannedLocation,this.status="Found";var i=t.event[0].end?l(t.event[0].end).subtract(TRANSITION_LENGTH,"ms").diff(Date.now()):c()+EVENT_LENGTH-TRANSITION_LENGTH;this.transitionTimeout=window.setTimeout(e.onScan.bind(e,null),i)}else t?this.status="Lost":(this.status="Lost",this.recentScan=null);e.updateDisplay()},u(function(){["Lost"].concat(o.keys(LOCATION_IMAGES),"Absent").forEach(function(t){var e=t.match(/ipad/i)?"iPad Center":s(t),i=u("<button>").addClass("btn btn-info btn-block").text(e),n=u("<li>").append(i);u("#location-filters").append(n),u("<div>").addClass("row").attr("id",e.replace(/ /g,"")).append(u("<h3>").text(e)).appendTo(u("#locations-container"))}),u("#location-filters button").click(function(t){h=u(this).text(),"All"===h?u("#locations-container > div").show():(u("#locations-container > div").hide(),u("#"+h.replace(/ /g,"")).show()),u("#location-filters button.btn-warning").removeClass("btn-warning").addClass("btn-info"),u(this).removeClass("btn-info").addClass("btn-warning")}),u.get("api/user",function(t){d=o.map(t,function(t){return new p(t)})});var t=io.connect();t.on("SCAN!",a),u(".all-absent").on("click",function(){u.ajax("/api/user/bulk",{type:"PUT",contentType:"application/json",data:JSON.stringify({absent:!0})})})})}]);